import streamlit as st
import pandas as pd
import plotly.express as px

# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–ö–ò ---
st.set_page_config(
    page_title="Digital Health Dashboard",
    page_icon="‚öïÔ∏è",
    layout="wide", # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤—Å—é —à–∏—Ä–∏–Ω—É –µ–∫—Ä–∞–Ω–∞
    initial_sidebar_state="expanded"
)

# --- –§–£–ù–ö–¶–Ü–Ø –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• ---
# st.cache_data –¥–æ–∑–≤–æ–ª—è—î –Ω–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ñ–∞–π–ª —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É
@st.cache_data
def load_data():
    # –®–ª—è—Ö –¥–æ –Ω–∞—à–æ–≥–æ "–∑–æ–ª–æ—Ç–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É"
    df = pd.read_csv('data/processed/cleaned_data.csv')
    return df

df = load_data()

# --- –ë–û–ö–û–í–ê –ü–ê–ù–ï–õ–¨ (SIDEBAR) ---
st.sidebar.title("üõ† –ù–∞–≤—ñ–≥–∞—Ü—ñ—è")
page = st.sidebar.radio(
    "–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–¥—ñ–ª –ø—Ä–æ—î–∫—Ç—É:",
    ["–ì–æ–ª–æ–≤–Ω–∞", "–ê–Ω–∞–ª—ñ–∑ –≥—ñ–ø–æ—Ç–µ–∑", "–ì–ª–æ–±–∞–ª—å–Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—è", "ML –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"]
)

st.sidebar.markdown("---")
st.sidebar.info("–ü—Ä–æ—î–∫—Ç –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤: [Vitalii Chernetskyi]")

# --- –õ–û–ì–Ü–ö–ê –ü–ï–†–ï–ú–ò–ö–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–û–ö ---

if page == "–ì–æ–ª–æ–≤–Ω–∞":
    st.title("üìä –ê–Ω–∞–ª—ñ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤—ñ–¥ —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂")
    st.write("""
    –í—ñ—Ç–∞—î–º–æ —É –¥–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫–æ–º—É –ø—Ä–æ—î–∫—Ç—ñ, –ø—Ä–∏—Å–≤—è—á–µ–Ω–æ–º—É –∞–Ω–∞–ª—ñ–∑—É —Ü–∏—Ñ—Ä–æ–≤–∏—Ö –∑–≤–∏—á–æ–∫ –º–æ–ª–æ–¥—ñ. 
    –ú–∏ –¥–æ—Å–ª—ñ–¥–∏–ª–∏ –¥–∞–Ω—ñ 700+ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ —É—Å—å–æ–≥–æ —Å–≤—ñ—Ç—É, —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –µ–∫—Ä–∞–Ω–Ω–∏–π —á–∞—Å 
    –≤–ø–ª–∏–≤–∞—î –Ω–∞ –Ω–∞—à–µ —Ä–µ–∞–ª—å–Ω–µ –∂–∏—Ç—Ç—è.
    """)
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è KPI
    st.subheader("–ö–ª—é—á–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ (Global Metrics)")
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric("–†–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç—ñ–≤", len(df))
    with col2:
        st.metric("–°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å", f"{df['Avg_Daily_Usage_Hours'].mean():.1f} –≥–æ–¥")
    with col3:
        st.metric("–†—ñ–≤–µ–Ω—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ", f"{df['Addicted_Score'].mean():.1f}/10")
    with col4:
        st.metric("–†–µ–≥—ñ–æ–Ω—ñ–≤", df['Region'].nunique())

    st.write("---")
    st.subheader("–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö")
    st.dataframe(df.head(10), use_container_width=True)

elif page == "–ê–Ω–∞–ª—ñ–∑ –≥—ñ–ø–æ—Ç–µ–∑":
    st.title("üß™ –ì–ª–∏–±–æ–∫–∏–π –∞–Ω–∞–ª—ñ–∑ –≥—ñ–ø–æ—Ç–µ–∑")
    st.write("–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è –ø—Ä–æ –≤–ø–ª–∏–≤ —Å–æ—Ü–º–µ—Ä–µ–∂ –Ω–∞ –∂–∏—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤.")

    # –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≥—Ä—É–ø –≥—ñ–ø–æ—Ç–µ–∑
    tab1, tab2, tab3 = st.tabs(["üè• –ó–¥–æ—Ä–æ–≤'—è —Ç–∞ –ü—Å–∏—Ö—ñ–∫–∞", "üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏", "ü§ù –°–æ—Ü—ñ–∞–ª—å–Ω—ñ –∑–≤'—è–∑–∫–∏"])

    with tab1:
        st.header("–í–ø–ª–∏–≤ –Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∏–π —Ç–∞ –º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω")
        
        # –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è –≤—Å—ñ—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ —É —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ
        level_order = {"Addiction_Level": ["Low", "Medium", "High"]}
        
        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 1: –°–æ–Ω vs –ß–∞—Å —É –º–µ—Ä–µ–∂—ñ
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 1: –°–æ—Ü–º–µ—Ä–µ–∂—ñ —Ç–∞ —è–∫—ñ—Å—Ç—å —Å–Ω—É")
        fig1 = px.scatter(
            df, 
            x="Avg_Daily_Usage_Hours", 
            y="Sleep_Hours_Per_Night",
            color="Addiction_Level",
            trendline="ols",
            title="–ó–≤'—è–∑–æ–∫ –º—ñ–∂ —á–∞—Å–æ–º —É –º–µ—Ä–µ–∂—ñ —Ç–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—é —Å–Ω—É",
            labels={"Avg_Daily_Usage_Hours": "–ì–æ–¥–∏–Ω —É –º–µ—Ä–µ–∂—ñ", "Sleep_Hours_Per_Night": "–ì–æ–¥–∏–Ω —Å–Ω—É"},
            color_discrete_map={"Low": "green", "Medium": "orange", "High": "red"},
            category_orders=level_order # –î–æ–¥–∞–Ω–æ –ø–æ—Ä—è–¥–æ–∫!
        )
        st.plotly_chart(fig1, use_container_width=True)
        st.success("**–í–∏—Å–Ω–æ–≤–æ–∫:** –ß—ñ—Ç–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—è. –ß–∏–º –±—ñ–ª—å—à–µ —á–∞—Å—É —Å—Ç—É–¥–µ–Ω—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å —É —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö, —Ç–∏–º –º–µ–Ω—à–µ –≤—ñ–Ω —Å–ø–∏—Ç—å.")

        st.write("---")

        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 2: –ü—Å–∏—Ö—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤'—è vs Addicted Score
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 2: –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —Ç–∞ –º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω")
        fig2 = px.box(
            df, 
            x="Addiction_Level", 
            y="Mental_Health_Score",
            color="Addiction_Level",
            points="all",
            title="–†–æ–∑–ø–æ–¥—ñ–ª –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ –ø—Å–∏—Ö—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è –∑–∞ —Ä—ñ–≤–Ω–µ–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ",
            labels={
                "Addiction_Level": "–†—ñ–≤–µ–Ω—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ", 
                "Mental_Health_Score": "–ë–∞–ª –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è"
            },
            color_discrete_map={"Low": "green", "Medium": "orange", "High": "red"},
            category_orders=level_order # –î–æ–¥–∞–Ω–æ –ø–æ—Ä—è–¥–æ–∫!
        )
        st.plotly_chart(fig2, use_container_width=True)
        st.success("**–í–∏—Å–Ω–æ–≤–æ–∫:** –°—Ç—É–¥–µ–Ω—Ç–∏ –∑ –≤–∏—Å–æ–∫–∏–º —Ä—ñ–≤–Ω–µ–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–∞—é—Ç—å –∑–Ω–∞—á–Ω–æ –Ω–∏–∂—á—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è.")
    
    
    with tab2:
        st.header("–ê–Ω–∞–ª—ñ–∑ –∑–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏")
        
        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 3: –Ø–∫—ñ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –Ω–∞–π–±—ñ–ª—å—à "–∞–¥–∏–∫—Ç–∏–≤–Ω—ñ"?
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 3: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ –∑ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ—á–Ω–æ—é —Å—Ç—Ä—ñ—á–∫–æ—é vs –Ü–Ω—à—ñ")
        
        # –†–∞—Ö—É—î–º–æ —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏
        platform_stats = df.groupby('Dominant_Platform')['Addicted_Score'].mean().sort_values(ascending=False).reset_index()
        
        fig3 = px.bar(
            platform_stats,
            x="Dominant_Platform",
            y="Addicted_Score",
            color="Addicted_Score",
            title="–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∑–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏",
            labels={
                "Dominant_Platform": "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞", 
                "Addicted_Score": "–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ"
            },
            color_continuous_scale="Reds"
        )
        st.plotly_chart(fig3, use_container_width=True)
        
        st.info("""
        **–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞:** –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ —è–∫ **TikTok** —Ç–∞ **Instagram** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—ó —Å—Ç—Ä—ñ—á–∫–∏, 
        —â–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î—Ç—å—Å—è –≤–∏—â–∏–º –±–∞–ª–æ–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Å–µ—Ä–µ–¥ —ó—Ö–Ω—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –Ω–∞—à–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—ñ.
        """)






elif page == "–ì–ª–æ–±–∞–ª—å–Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—è":
    st.title("üåç –ì–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª")
    st.info("–†–æ–∑–¥—ñ–ª –∑ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—é –∫–∞—Ä—Ç–æ—é —Å–≤—ñ—Ç—É —Ç–∞ —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–º–∏ —ñ–Ω—Å–∞–π—Ç–∞–º–∏.")

elif page == "ML –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞":
    st.title("ü§ñ –ú–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è: –ü–µ—Ä–µ–≤—ñ—Ä —Å–µ–±–µ")
    st.info("–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –±–ª–æ–∫ –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é.")
