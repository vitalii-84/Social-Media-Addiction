import streamlit as st
import pandas as pd
import plotly.express as px

# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–ö–ò ---
st.set_page_config(
    page_title="Digital Health Dashboard",
    page_icon="‚öïÔ∏è",
    layout="wide", # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤—Å—é —à–∏—Ä–∏–Ω—É –µ–∫—Ä–∞–Ω–∞
    initial_sidebar_state="expanded"
)

# --- –§–£–ù–ö–¶–Ü–Ø –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• ---
@st.cache_data
def load_data():
    # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ—á–∏—â–µ–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É
    df = pd.read_csv('data/processed/cleaned_data.csv')
    return df

df = load_data()

# --- –ë–û–ö–û–í–ê –ü–ê–ù–ï–õ–¨ (SIDEBAR) ---
st.sidebar.title("üõ† –ù–∞–≤—ñ–≥–∞—Ü—ñ—è")
page = st.sidebar.radio(
    "–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–¥—ñ–ª –ø—Ä–æ—î–∫—Ç—É:",
    ["–ì–æ–ª–æ–≤–Ω–∞", "–ê–Ω–∞–ª—ñ–∑ –≥—ñ–ø–æ—Ç–µ–∑", "–ì–ª–æ–±–∞–ª—å–Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—è", "ML –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"]
)

st.sidebar.markdown("---")
st.sidebar.info("–ü—Ä–æ—î–∫—Ç –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤: Vitalii Chernetskyi")

# --- –õ–û–ì–Ü–ö–ê –ü–ï–†–ï–ú–ò–ö–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–û–ö ---

if page == "–ì–æ–ª–æ–≤–Ω–∞":
    st.title("üìä –ê–Ω–∞–ª—ñ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤—ñ–¥ —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂")
    st.write("""
    –í—ñ—Ç–∞—î–º–æ —É –¥–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫–æ–º—É –ø—Ä–æ—î–∫—Ç—ñ, –ø—Ä–∏—Å–≤—è—á–µ–Ω–æ–º—É –∞–Ω–∞–ª—ñ–∑—É —Ü–∏—Ñ—Ä–æ–≤–∏—Ö –∑–≤–∏—á–æ–∫ –º–æ–ª–æ–¥—ñ. 
    –ú–∏ –¥–æ—Å–ª—ñ–¥–∏–ª–∏ –¥–∞–Ω—ñ 700+ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ —É—Å—å–æ–≥–æ —Å–≤—ñ—Ç—É, —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –µ–∫—Ä–∞–Ω–Ω–∏–π —á–∞—Å 
    –≤–ø–ª–∏–≤–∞—î –Ω–∞ –Ω–∞—à–µ —Ä–µ–∞–ª—å–Ω–µ –∂–∏—Ç—Ç—è.
    """)
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è KPI (Key Performance Indicators)
    st.subheader("–ö–ª—é—á–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ (Global Metrics)")
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric("–†–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç—ñ–≤", len(df))
    with col2:
        st.metric("–°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å", f"{df['Avg_Daily_Usage_Hours'].mean():.1f} –≥–æ–¥")
    with col3:
        st.metric("–†—ñ–≤–µ–Ω—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ", f"{df['Addicted_Score'].mean():.1f}/10")
    with col4:
        st.metric("–†–µ–≥—ñ–æ–Ω—ñ–≤", df['Region'].nunique())

    st.write("---")
    st.subheader("–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö")
    # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–æ–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä width='stretch' –∑–∞–º—ñ—Å—Ç—å use_container_width
    st.dataframe(df.head(10), width=None)

elif page == "–ê–Ω–∞–ª—ñ–∑ –≥—ñ–ø–æ—Ç–µ–∑":
    st.title("üß™ –ì–ª–∏–±–æ–∫–∏–π –∞–Ω–∞–ª—ñ–∑ –≥—ñ–ø–æ—Ç–µ–∑")
    st.write("–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è –ø—Ä–æ –≤–ø–ª–∏–≤ —Å–æ—Ü–º–µ—Ä–µ–∂ –Ω–∞ –∂–∏—Ç—Ç—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤.")

    # –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≥—Ä—É–ø –≥—ñ–ø–æ—Ç–µ–∑
    tab1, tab2, tab3 = st.tabs(["üè• –ó–¥–æ—Ä–æ–≤'—è —Ç–∞ –ü—Å–∏—Ö—ñ–∫–∞", "üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏", "ü§ù –°–æ—Ü—ñ–∞–ª—å–Ω—ñ –∑–≤'—è–∑–∫–∏"])

    # –°–ø—ñ–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ–π
    level_order = {"Addiction_Level": ["Low", "Medium", "High"]}

    with tab1:
        st.header("–í–ø–ª–∏–≤ –Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∏–π —Ç–∞ –º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω")
        
        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 1: –°–æ–Ω vs –ß–∞—Å —É –º–µ—Ä–µ–∂—ñ
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 1: –°–æ—Ü–º–µ—Ä–µ–∂—ñ —Ç–∞ —è–∫—ñ—Å—Ç—å —Å–Ω—É")
        fig1 = px.scatter(
            df, 
            x="Avg_Daily_Usage_Hours", 
            y="Sleep_Hours_Per_Night",
            color="Addiction_Level",
            trendline="ols",
            title="–ó–≤'—è–∑–æ–∫ –º—ñ–∂ —á–∞—Å–æ–º —É –º–µ—Ä–µ–∂—ñ —Ç–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—é —Å–Ω—É",
            labels={"Avg_Daily_Usage_Hours": "–ì–æ–¥–∏–Ω —É –º–µ—Ä–µ–∂—ñ", "Sleep_Hours_Per_Night": "–ì–æ–¥–∏–Ω —Å–Ω—É"},
            color_discrete_map={"Low": "green", "Medium": "orange", "High": "red"},
            category_orders=level_order
        )
        st.plotly_chart(fig1, width='stretch')
        st.success("**–í–∏—Å–Ω–æ–≤–æ–∫:** –ß—ñ—Ç–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—è. –ó—Ä–æ—Å—Ç–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —á–∞—Å—É –≤–µ–¥–µ –¥–æ —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ —Å–Ω—É.")

        st.write("---")

        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 2: –ü—Å–∏—Ö—ñ—á–Ω–µ –∑–¥–æ—Ä–æ–≤'—è vs Addicted Score
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 2: –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —Ç–∞ –º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω")
        fig2 = px.box(
            df, 
            x="Addiction_Level", 
            y="Mental_Health_Score",
            color="Addiction_Level",
            points="all",
            title="–†–æ–∑–ø–æ–¥—ñ–ª –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ –ø—Å–∏—Ö—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è",
            labels={"Addiction_Level": "–†—ñ–≤–µ–Ω—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ", "Mental_Health_Score": "–ë–∞–ª –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è"},
            color_discrete_map={"Low": "green", "Medium": "orange", "High": "red"},
            category_orders=level_order
        )
        st.plotly_chart(fig2, width='stretch')
        st.success("**–í–∏—Å–Ω–æ–≤–æ–∫:** –°—Ç—É–¥–µ–Ω—Ç–∏ –∑ –≤–∏—Å–æ–∫–∏–º —Ä—ñ–≤–Ω–µ–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–∞—é—Ç—å –Ω–∏–∂—á–∏–π –º–µ–¥—ñ–∞–Ω–Ω–∏–π –±–∞–ª –ø—Å–∏—Ö—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è.")

    with tab2:
        st.header("–ê–Ω–∞–ª—ñ–∑ –∑–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏")
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 3: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ –∑ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ—á–Ω–æ—é —Å—Ç—Ä—ñ—á–∫–æ—é vs –Ü–Ω—à—ñ")
        
        # –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –∑–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ—é
        platform_stats = df.groupby('Most_Used_Platform')['Addicted_Score'].mean().sort_values(ascending=False).reset_index()
        
        fig3 = px.bar(
            platform_stats,
            x="Most_Used_Platform",
            y="Addicted_Score",
            color="Addicted_Score",
            title="–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∑–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏",
            labels={"Most_Used_Platform": "–û—Å–Ω–æ–≤–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞", "Addicted_Score": "–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ"},
            color_continuous_scale="Reds"
        )
        st.plotly_chart(fig3, width='stretch')
        st.info("**–Ü–Ω—Å–∞–π—Ç:** –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ –∑ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—é –ø—Ä–æ–∫—Ä—É—Ç–∫–æ—é (TikTok/Instagram) –ª—ñ–¥—É—é—Ç—å –∑–∞ —Ä—ñ–≤–Ω–µ–º –∞–¥–∏–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.")

    with tab3:
        st.header("–°–æ—Ü—ñ–∞–ª—å–Ω—ñ –∑–≤'—è–∑–∫–∏ —Ç–∞ –Ω–∞–≤—á–∞–Ω–Ω—è")
        
        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 4 & 6: –í–ø–ª–∏–≤ —Å—Ç–∞—Ç—É—Å—É —Å—Ç–æ—Å—É–Ω–∫—ñ–≤
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 4 —Ç–∞ 6: –°—Ç–∞—Ç—É—Å —Å—Ç–æ—Å—É–Ω–∫—ñ–≤")
        rel_stats = df.groupby('Relationship_Status')['Addicted_Score'].mean().sort_values().reset_index()
        
        fig4 = px.bar(
            rel_stats,
            x="Addicted_Score",
            y="Relationship_Status",
            orientation='h',
            title="–°–µ—Ä–µ–¥–Ω—è –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º —Å—Ç–æ—Å—É–Ω–∫—ñ–≤",
            labels={"Relationship_Status": "–°—Ç–∞—Ç—É—Å —Å—Ç–æ—Å—É–Ω–∫—ñ–≤", "Addicted_Score": "–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ"},
            color="Addicted_Score",
            color_continuous_scale="Viridis"
        )
        st.plotly_chart(fig4, width='stretch')
        
        st.write("---")
        
        # –ì—ñ–ø–æ—Ç–µ–∑–∞ 5: –í–ø–ª–∏–≤ –Ω–∞ –Ω–∞–≤—á–∞–Ω–Ω—è
        st.subheader("–ì—ñ–ø–æ—Ç–µ–∑–∞ 5: –í–ø–ª–∏–≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –Ω–∞ —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å")
        
        # –í–ò–ü–†–ê–í–õ–ï–ù–û: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Affects_Academic_Performance_Numeric –∑–≥—ñ–¥–Ω–æ –∑—ñ —Å–ø–∏—Å–∫–æ–º –∫–æ–ª–æ–Ω–æ–∫
        fig5 = px.box(
            df,
            x="Addiction_Level",
            y="Affects_Academic_Performance_Numeric",
            color="Addiction_Level",
            title="–ó–≤'—è–∑–æ–∫ —Ä—ñ–≤–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ",
            labels={
                "Addiction_Level": "–†—ñ–≤–µ–Ω—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ",
                "Affects_Academic_Performance_Numeric": "–í–ø–ª–∏–≤ –Ω–∞ –Ω–∞–≤—á–∞–Ω–Ω—è (0 - –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏–π, 1 - –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–π/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π)"
            },
            color_discrete_map={"Low": "green", "Medium": "orange", "High": "red"},
            category_orders=level_order
        )
        st.plotly_chart(fig5, width='stretch')
        st.success("**–í–µ—Ä–¥–∏–∫—Ç:** –ì—ñ–ø–æ—Ç–µ–∑–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞ ‚Äî –≤–∏—Å–æ–∫–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ –∫–æ—Ä–µ–ª—é—î –∑ –∞–∫–∞–¥–µ–º—ñ—á–Ω–∏–º–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∞–º–∏.")

elif page == "–ì–ª–æ–±–∞–ª—å–Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—è":
    st.title("üåç –ì–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª")
    st.info("–†–æ–∑–¥—ñ–ª –∑ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—é –∫–∞—Ä—Ç–æ—é —Å–≤—ñ—Ç—É —Ç–∞ —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–º–∏ —ñ–Ω—Å–∞–π—Ç–∞–º–∏.")

elif page == "ML –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞":
    st.title("ü§ñ –ú–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è: –ü–µ—Ä–µ–≤—ñ—Ä —Å–µ–±–µ")
    st.info("–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –±–ª–æ–∫ –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é.")
